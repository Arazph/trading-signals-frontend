<!doctype html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Trading Signals v0.1</title>
  <style>
    /* ----- theme vars ----- */
    :root[data-theme="dark"]{--bg:#0d1117;--card:#161b22;--text:#c9d1d9;--accent:#58a6ff;--green:#3fb950;--red:#f85149}
    :root[data-theme="light"]{--bg:#f6f8fa;--card:#ffffff;--text:#24292f;--accent:#0969da;--green:#1a7f37;--red:#d1242f}
    /* ----- global ----- */
    *{box-sizing:border-box;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Helvetica,Arial,sans-serif}
    body{margin:0;background:var(--bg);color:var(--text);min-height:100vh;display:flex;align-items:center;justify-content:center;padding:2rem}
    a{color:var(--accent);text-decoration:none}
    /* ----- glass card ----- */
    .card{background:var(--card);border:1px solid var(--bg);border-radius:16px;box-shadow:0 8px 32px rgba(0,0,0,.2);width:100%;max-width:420px;padding:2rem;backdrop-filter:blur(4px)}
    /* ----- header ----- */
    .head{display:flex;justify-content:space-between;align-items:center;margin-bottom:1.5rem}
    #themeToggle{background:var(--card);border:1px solid var(--bg);border-radius:50%;width:40px;height:40px;font-size:20px;cursor:pointer;transition:transform .2s}
    #themeToggle:hover{transform:rotate(30deg)}
    h1{margin:0;font-size:1.5rem;font-weight:600}
    /* ----- form ----- */
    .form{display:flex;flex-direction:column;gap:.75rem}
    label{font-size:.9rem;font-weight:500}
    input,select{padding:.75rem;border:1px solid var(--bg);border-radius:8px;background:var(--card);color:var(--text);font-size:1rem;transition:border-color .2s}
    input:focus,select:focus{outline:none;border-color:var(--accent)}
    .row{display:flex;gap:.5rem}
    .row input{flex:1}
    /* ----- buttons ----- */
    .btn{padding:.75rem 1rem;border:none;border-radius:8px;font-size:1rem;font-weight:600;cursor:pointer;transition:all .2s}
    .primary{background:var(--accent);color:#fff}
    .primary:hover{filter:brightness(1.1)}
    .secondary{background:var(--card);color:var(--accent);border:1px solid var(--accent)}
    /* ----- output ----- */
    pre{margin:1rem 0 0;padding:1rem;border-radius:8px;background:var(--bg);font-size:.9rem;max-height:300px;overflow:auto}
    /* ----- lang selector ----- */
    #lang{background:var(--card);border:1px solid var(--bg);border-radius:8px;padding:.25rem .5rem;font-size:.8rem}
    /* ----- animations ----- */
    @keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
    .card{animation:fadeIn .6s ease-out}
  </style>
</head>
<body>
  <div class="card">
    <div class="head">
      <select id="lang"></select>
      <button id="themeToggle" title="Toggle theme">ðŸŒ“</button>
    </div>

    <h1 id="title">Free Trading Signals (v0.1)</h1>

    <div class="form">
      <label id="coinLbl">Coin</label>
      <input id="coin" placeholder="BTC" value="BTC"/>

      <label id="slLbl">SL %</label>
      <input id="sl" type="number" min="0.5" max="10" step="0.1" value="2"/>

      <button id="go" class="btn primary">Get Signal</button>
      <button id="csv" class="btn secondary">Export CSV</button>
    </div>

    <pre id="out">Click Get Signal</pre>
  </div>

  <script>
    const HF = 'https://arazph-trading-signals-backend.hf.space/signal';
    const html = document.documentElement;

    // ===== I18N =====
    const texts = {
      en:{title:"Free Trading Signals (v0.1)",coin:"Coin",sl:"SL %",go:"Get Signal",csv:"Export CSV",out:"Click Get Signal",loading:"â³ loadingâ€¦",error:"âŒ "},
      es:{title:"SeÃ±ales de Trading Gratis (v0.1)",coin:"Moneda",sl:"SL %",go:"Obtener SeÃ±al",csv:"Exportar CSV",out:"Haz clic para obtener seÃ±al",loading:"â³ cargandoâ€¦",error:"âŒ "},
      fr:{title:"Signaux de Trading Gratuits (v0.1)",coin:"PiÃ¨ce",sl:"SL %",go:"Obtenir Signal",csv:"Exporter CSV",out:"Cliquez pour obtenir le signal",loading:"â³ chargementâ€¦",error:"âŒ "},
      ar:{title:"Ø¥Ø´Ø§Ø±Ø§Øª ØªØ¯Ø§ÙˆÙ„ Ù…Ø¬Ø§Ù†ÙŠØ© (v0.1)",coin:"Ø¹Ù…Ù„Ø©",sl:"SL %",go:"Ø§Ø­ØµÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø¥Ø´Ø§Ø±Ø©",csv:"ØªØµØ¯ÙŠØ± CSV",out:"Ø§Ù†Ù‚Ø± Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø¥Ø´Ø§Ø±Ø©",loading:"â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„â€¦",error:"âŒ "},
      tr:{title:"Ãœcretsiz Trading Sinyalleri (v0.1)",coin:"Coin",sl:"SL %",go:"Sinyal Al",csv:"CSV DÄ±ÅŸa Aktar",out:"Sinyal almak iÃ§in tÄ±klayÄ±n",loading:"â³ yÃ¼kleniyorâ€¦",error:"âŒ "},
      ru:{title:"Ð‘ÐµÑÐ¿Ð»Ð°Ñ‚Ð½Ñ‹Ðµ Ð¢Ð¾Ñ€Ð³Ð¾Ð²Ñ‹Ðµ Ð¡Ð¸Ð³Ð½Ð°Ð»Ñ‹ (v0.1)",coin:"ÐœÐ¾Ð½ÐµÑ‚Ð°",sl:"SL %",go:"ÐŸÐ¾Ð»ÑƒÑ‡Ð¸Ñ‚ÑŒ Ð¡Ð¸Ð³Ð½Ð°Ð»",csv:"Ð­ÐºÑÐ¿Ð¾Ñ€Ñ‚ CSV",out:"ÐÐ°Ð¶Ð¼Ð¸Ñ‚Ðµ, Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð¿Ð¾Ð»ÑƒÑ‡Ð¸Ñ‚ÑŒ ÑÐ¸Ð³Ð½Ð°Ð»",loading:"â³ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ°â€¦",error:"âŒ "},
      "zh-CN":{title:"å…è´¹äº¤æ˜“ä¿¡å· (v0.1)",coin:"å¸ç§",sl:"SL %",go:"èŽ·å–ä¿¡å·",csv:"å¯¼å‡º CSV",out:"ç‚¹å‡»èŽ·å–ä¿¡å·",loading:"â³ åŠ è½½ä¸­â€¦",error:"âŒ "},
      pt:{title:"Sinais de Trading Gratuitos (v0.1)",coin:"Moeda",sl:"SL %",go:"Obter Sinal",csv:"Exportar CSV",out:"Clique para obter o sinal",loading:"â³ carregandoâ€¦",error:"âŒ "},
      id:{title:"Sinyal Trading Gratis (v0.1)",coin:"Koin",sl:"SL %",go:"Dapatkan Sinyal",csv:"Ekspor CSV",out:"Klik untuk mendapatkan sinyal",loading:"â³ memuatâ€¦",error:"âŒ "},
      vi:{title:"TÃ­n Hiá»‡u Giao Dá»‹ch Miá»…n PhÃ­ (v0.1)",coin:"Coin",sl:"SL %",go:"Láº¥y TÃ­n Hiá»‡u",csv:"Xuáº¥t CSV",out:"Nháº¥n Ä‘á»ƒ láº¥y tÃ­n hiá»‡u",loading:"â³ Ä‘ang táº£iâ€¦",error:"âŒ "}
    };

    const langSel = document.getElementById('lang');
    const ui = {};
    ["title","coinLbl","slLbl","go","csv","out"].forEach(id=>ui[id]=document.getElementById(id));

    function setLang(lang){
      if(!texts[lang]) lang='en';
      html.setAttribute('lang',lang);
      localStorage.setItem('lang',lang);
      Object.keys(ui).forEach(id=>ui[id].childNodes[0].textContent=texts[lang][id]);
      langSel.value=lang;
    }
    const browserLang = navigator.language.slice(0,2);
    const savedLang   = localStorage.getItem('lang') || browserLang;
    Object.keys(texts).forEach(l=>{
      const o=document.createElement('option');o.value=l;o.textContent=l.toUpperCase();langSel.appendChild(o);
    });
    langSel.addEventListener('change',e=>setLang(e.target.value));
    setLang(savedLang);

    // ===== THEME =====
    const toggle = document.getElementById('themeToggle');
    const savedTheme = localStorage.getItem('theme') || 'dark';
    html.setAttribute('data-theme',savedTheme);
    toggle.addEventListener('click',()=>{
      const cur=html.getAttribute('data-theme');
      const nxt=cur==='dark'?'light':'dark';
      html.setAttribute('data-theme',nxt);
      localStorage.setItem('theme',nxt);
    });

    // ===== SIGNAL + CSV =====
    let lastSignal = null;
    document.getElementById('go').onclick = async () => {
      const c = document.getElementById('coin').value.trim() || 'BTC';
      const s = document.getElementById('sl').value;
      ui.out.textContent = texts[savedLang].loading;
      try {
        const res = await fetch(`${HF}?symbol=${c}&sl_pct=${s}`);
        if (!res.ok) throw new Error('Backend error '+res.status);
        lastSignal = await res.json();
        ui.out.textContent = JSON.stringify(lastSignal,null,2);
      } catch (e) {
        ui.out.textContent = texts[savedLang].error + e;
      }
    };

    document.getElementById('csv').onclick = () => {
      if (!lastSignal) return alert('Get a signal first');
      const row = [
        new Date().toISOString(),
        lastSignal.symbol,
        lastSignal.direction,
        lastSignal.entry,
        lastSignal.sl,
        lastSignal.tp,
        lastSignal.confidence,
        lastSignal.why
      ];
      const csv = row.map(x=>'"'+String(x).replace(/"/g,'""')+'"').join(',');
      const blob = new Blob([csv],{type:'text/csv'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'trade_'+lastSignal.symbol+'_'+Date.now()+'.csv';
      a.click();
      URL.revokeObjectURL(url);
    };
  </script>
</body>
</html>
