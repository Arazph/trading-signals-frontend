<!doctype html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Trading Signals Pro · v0.1</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root[data-theme="dark"]{--bg:#0f172a;--surface:#1e293b;--border:#334155;--text:#f1f5f9;--sub:#94a3b8;--accent:#38bdf8;--profit:#34d399;--loss:#f87171}
    :root[data-theme="light"]{--bg:#f8fafc;--surface:#ffffff;--border:#e2e8f0;--text:#0f172a;--sub:#64748b;--accent:#0ea5e9;--profit:#10b981;--loss:#ef4444}
    *{box-sizing:border-box;font-family:'Inter',system-ui,sans-serif}
    body{margin:0;background:var(--bg);color:var(--text);min-height:100vh;display:flex;align-items:center;justify-content:center;padding:1rem;animation:fadeIn .7s ease-out}
    @keyframes fadeIn{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}
    .card{width:100%;max-width:480px;background:var(--surface);border:1px solid var(--border);border-radius:24px;box-shadow:0 25px 50px -12px rgba(0,0,0,.25);padding:2rem;display:flex;flex-direction:column;gap:1.25rem}
    .head{display:flex;justify-content:space-between;align-items:center}
    .logo{font-size:1.5rem;font-weight:700;letter-spacing:-.5px}
    #themeToggle{background:var(--surface);border:1px solid var(--border);border-radius:50%;width:40px;height:40px;font-size:20px;cursor:pointer;transition:transform .2s}
    #themeToggle:hover{transform:rotate(30deg)}
    .input-group{display:flex;flex-direction:column;gap:.25rem}
    .input-group label{font-size:.875rem;font-weight:500}
    .input-group input{padding:.75rem;border:1px solid var(--border);border-radius:12px;background:var(--surface);color:var(--text);font-size:1rem;transition:border-color .2s}
    .input-group input:focus{outline:none;border-color:var(--accent)}
    .flex{display:flex;gap:.5rem}
    .btn{flex:1;padding:.875rem 1rem;border-radius:12px;font-size:1rem;font-weight:600;border:none;cursor:pointer;transition:all .2s}
    .btn-primary{background:var(--accent);color:#fff}
    .btn-primary:hover{filter:brightness(1.1)}
    .btn-secondary{background:transparent;color:var(--accent);border:1px solid var(--accent)}
    .btn-secondary:hover{background:var(--accent);color:#fff}
    .result{display:none;flex-direction:column;gap:1rem;margin-top:1rem}
    .result.show{display:flex}
    .badge{align-self:flex-start;padding:.25rem .75rem;border-radius:999px;font-size:.75rem;font-weight:600;text-transform:uppercase}
    .badge-long{background:var(--profit);color:#fff}
    .badge-short{background:var(--loss);color:#fff}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:1rem}
    .cell{background:var(--bg);padding:1rem;border-radius:12px}
    .cell .label{font-size:.75rem;opacity:.7;margin-bottom:.25rem}
    .cell .value{font-size:1.125rem;font-weight:600}
    .note{font-size:.8125rem;opacity:.7}
    #lang{background:var(--surface);border:1px solid var(--border);border-radius:8px;padding:.25rem .5rem;font-size:.8rem}
    a{color:var(--accent);text-decoration:none}
    a:hover{text-decoration:underline}
  </style>
</head>
<body>
  <div class="card">
    <div class="head">
      <select id="lang"></select>
      <button id="themeToggle" title="Toggle theme">🌓</button>
    </div>

    <div class="logo" id="title">Trading Signals Pro · v0.1</div>

    <div class="input-group">
      <label id="coinLbl">Coin</label>
      <input id="coin" placeholder="BTC" value="BTC"/>
    </div>

    <div class="input-group">
      <label id="slLbl">Stop-Loss %</label>
      <input id="sl" type="number" min="0.5" max="10" step="0.1" value="2"/>
    </div>

    <div class="flex">
      <button id="go" class="btn btn-primary">Get Signal</button>
      <button id="csv" class="btn btn-secondary">Export CSV</button>
    </div>

    <div id="result" class="result">
      <div class="flex">
        <span id="symbol" class="badge"></span>
        <span id="dirBadge" class="badge"></span>
      </div>

      <div class="grid">
        <div class="cell">
          <div class="label">Entry Price</div>
          <div class="value" id="entry">—</div>
        </div>
        <div class="cell">
          <div class="label">Stop-Loss</div>
          <div class="value" id="slVal">—</div>
        </div>
        <div class="cell">
          <div class="label">Take-Profit</div>
          <div class="value" id="tpVal">—</div>
        </div>
        <div class="cell">
          <div class="label">Confidence</div>
          <div class="value" id="conf">—</div>
        </div>
      </div>

      <div class="cell">
        <div class="label">Rationale & Sources</div>
        <div id="why" class="mt-1"></div>
      </div>

      <div class="note" id="notes">—</div>
    </div>

    <pre id="out" class="text-center">Click Get Signal</pre>
  </div>

  <script>
    const HF = 'https://arazph-trading-signals-backend.hf.space/signal';
    const html = document.documentElement;

    /* ---------- i18n ---------- */
    const texts = {
      en:{title:"Trading Signals Pro · v0.1",coin:"Coin",sl:"Stop-Loss %",go:"Get Signal",csv:"Export CSV",out:"Click Get Signal",loading:"⏳ Loading…",error:"❌ Backend error"},
      es:{title:"Señales Pro · v0.1",coin:"Moneda",sl:"Stop-Loss %",go:"Obtener Señal",csv:"Exportar CSV",out:"Haz clic para obtener señal",loading:"⏳ Cargando…",error:"❌ Error de backend"},
      fr:{title:"Signaux Pro · v0.1",coin:"Pièce",sl:"Stop-Loss %",go:"Obtenir Signal",csv:"Exporter CSV",out:"Cliquez pour obtenir le signal",loading:"⏳ Chargement…",error:"❌ Erreur backend"},
      ar:{title:"إشارات برو · v0.1",coin:"عملة",sl:"Stop-Loss %",go:"احصل على الإشارة",csv:"تصدير CSV",out:"انقر للحصول على الإشارة",loading:"⏳ جاري التحميل…",error:"❌ خطاء في الخادم"},
      tr:{title:"Pro Sinyaller · v0.1",coin:"Coin",sl:"Stop-Loss %",go:"Sinyal Al",csv:"CSV Dışa Aktar",out:"Sinyal almak için tıklayın",loading:"⏳ Yükleniyor…",error:"❌ Backend hatası"},
      ru:{title:"Pro Сигналы · v0.1",coin:"Монета",sl:"Stop-Loss %",go:"Получить Сигнал",csv:"Экспорт CSV",out:"Нажмите, чтобы получить сигнал",loading:"⏳ Загрузка…",error:"❌ Ошибка бэкенда"},
      "zh-CN":{title:"专业交易信号 · v0.1",coin:"币种",sl:"止损 %",go:"获取信号",csv:"导出 CSV",out:"点击获取信号",loading:"⏳ 加载中…",error:"❌ 后端错误"},
      pt:{title:"Sinais Pro · v0.1",coin:"Moeda",sl:"Stop-Loss %",go:"Obter Sinal",csv:"Exportar CSV",out:"Clique para obter o sinal",loading:"⏳ Carregando…",error:"❌ Erro de backend"},
      id:{title:"Sinyal Pro · v0.1",coin:"Koin",sl:"Stop-Loss %",go:"Dapatkan Sinyal",csv:"Ekspor CSV",out:"Klik untuk mendapatkan sinyal",loading:"⏳ Memuat…",error:"❌ Kesalahan backend"},
      vi:{title:"Tín Hiệu Pro · v0.1",coin:"Coin",sl:"Stop-Loss %",go:"Lấy Tín Hiệu",csv:"Xuất CSV",out:"Nhấn để lấy tín hiệu",loading:"⏳ Đang tải…",error:"❌ Lỗi backend"}
    };

    const langSel = document.getElementById('lang');
    const ui = {}; ["title","coinLbl","slLbl","go","csv","out"].forEach(id=>ui[id]=document.getElementById(id));
    function setLang(lang){
      if(!texts[lang]) lang='en';
      html.setAttribute('lang',lang);
      localStorage.setItem('lang',lang);
      Object.keys(ui).forEach(id=>ui[id].childNodes[0].textContent=texts[lang][id]);
      langSel.value=lang;
    }
    const browserLang = navigator.language.slice(0,2);
    const savedLang   = localStorage.getItem('lang') || browserLang;
    Object.keys(texts).forEach(l=>{
      const o=document.createElement('option');o.value=l;o.textContent=l.toUpperCase();langSel.appendChild(o);
    });
    langSel.addEventListener('change',e=>setLang(e.target.value));
    setLang(savedLang);

    /* ---------- theme ---------- */
    const toggle = document.getElementById('themeToggle');
    const savedTheme = localStorage.getItem('theme') || 'dark';
    html.setAttribute('data-theme',savedTheme);
    toggle.addEventListener('click',()=>{
      const cur=html.getAttribute('data-theme');
      const nxt=cur==='dark'?'light':'dark';
      html.setAttribute('data-theme',nxt);
      localStorage.setItem('theme',nxt);
    });

    /* ---------- signal + pretty card + long rationale ---------- */
    let lastSignal = null;
    const outBox = document.getElementById('out');
    const result = document.getElementById('result');

    function renderSignal(sig){
      const isLong = sig.direction === 'Long';
      document.getElementById('symbol').textContent = sig.symbol;
      document.getElementById('dirBadge').textContent = sig.direction;
      document.getElementById('dirBadge').className = isLong ? 'badge badge-long' : 'badge badge-short';
      document.getElementById('entry').textContent = Number(sig.entry).toFixed(2);
      document.getElementById('slVal').textContent = Number(sig.sl).toFixed(2);
      document.getElementById('tpVal').textContent = Number(sig.tp).toFixed(2);
      document.getElementById('conf').textContent = sig.confidence + '%';

      /* ========== LONG-FORM RATIONALE WITH CLICKABLE SOURCES ========== */
      const riskPct   = ((sig.entry - sig.sl) / sig.entry * 100).toFixed(2);
      const rewardPct = ((sig.tp - sig.entry) / sig.entry * 100).toFixed(2);
      const whaleBias = sig.whaleNote.split(' ')[2] || '0.0 %';

      const whyLong = `
<b>1. Micro-momentum</b><br>
Last 6-period close vs. current close = <b>${riskPct} %</b>.  
A positive micro-momentum suggests short-term buying pressure.  
<a href="https://www.investopedia.com/terms/m/momentum.asp" target="_blank" rel="noopener">Investopedia - Momentum</a><br><br>

<b>2. Whale flow</b><br>
Net buy/sell volume ratio = <b>${whaleBias}</b> (last 100 trades).  
When net buy > sell, large traders are accumulating.  
<a href="https://academy.binance.com/en/articles/what-is-a-whale" target="_blank" rel="noopener">Binance Academy - Whale</a><br><br>

<b>3. Options skew</b><br>
25-delta call-put difference = <b>0.0 %</b> (v0.1 stub).  
Positive skew = calls expensive → bullish; negative = puts expensive → bearish.  
<a href="https://www.investopedia.com/terms/o/optionskew.asp" target="_blank" rel="noopener">Investopedia - Skew</a><br><br>

<b>4. Risk : Reward maths</b><br>
Risk = <b>${Number(sig.sl).toFixed(2)}</b> (${riskPct} % below entry).<br>
Reward = <b>${Number(sig.tp).toFixed(2)}</b> (${rewardPct} % above entry).<br>
R:R ≈ 1 : 1.5 (automatically calculated).<br><br>

<b>5. Coin selection</b><br>
${sig.symbol} chosen for high liquidity & tight spreads; signal valid for next 10-min candle.  
Always verify on your exchange before placing orders.  
<a href="https://www.binance.com/en/futures/${sig.symbol}USDT" target="_blank" rel="noopener">Live ${sig.symbol}USDT on Binance</a>
      `;

      document.getElementById('why').innerHTML = whyLong;
      document.getElementById('notes').textContent = sig.whaleNote + ' | ' + sig.optionsNote;
      outBox.style.display = 'none';
      result.classList.add('show');
    }

    document.getElementById('go').onclick = async () => {
      const c = document.getElementById('coin').value.trim() || 'BTC';
      const s = document.getElementById('sl').value;
      outBox.textContent = texts[savedLang].loading;
      result.classList.remove('show');
      try {
        const res = await fetch(`${HF}?symbol=${c}&sl_pct=${s}`);
        if (!res.ok) throw new Error('Backend error '+res.status);
        lastSignal = await res.json();
        renderSignal(lastSignal);
      } catch (e) {
        outBox.textContent = texts[savedLang].error + e;
        result.classList.remove('show');
        outBox.style.display = 'block';
      }
    };

    /* ---------- CSV export ---------- */
    document.getElementById('csv').onclick = () => {
      if (!lastSignal) return alert('Get a signal first');
      const row = [
        new Date().toISOString(),
        lastSignal.symbol,
        lastSignal.direction,
        lastSignal.entry,
        lastSignal.sl,
        lastSignal.tp,
        lastSignal.confidence,
        lastSignal.why
      ];
      const csv = row.map(x=>'"'+String(x).replace(/"/g,'""')+'"').join(',');
      const blob = new Blob([csv],{type:'text/csv'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'trade_'+lastSignal.symbol+'_'+Date.now()+'.csv';
      a.click();
      URL.revokeObjectURL(url);
    };
  </script>
</body>
</html>
