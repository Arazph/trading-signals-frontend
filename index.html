<!doctype html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="utf-8"/>
  <title>Trading Signals v0.1</title>
  <style>
    :root[data-theme="dark"]{--bg:#111;--text:#0f0;--panel:#000;--btn:#222}
    :root[data-theme="light"]{--bg:#fff;--text:#222;--panel:#f7f7f7;--btn:#ddd}
    body{font-family:system-ui;background:var(--bg);color:var(--text);padding:2rem;max-width:700px;margin:auto}
    label,input,button,select{padding:8px;font-size:16px;margin:4px 0}
    input{width:100px}
    pre{background:var(--panel);padding:1rem;white-space:pre-wrap}
    .error{color:#f44}
    #topBar{display:flex;justify-content:space-between;align-items:center}
  </style>
</head>
<body>
  <div id="topBar">
    <select id="lang"></select>
    <button id="themeToggle">ðŸŒ“</button>
  </div>

  <h1 id="title">Free Trading Signals (v0.1)</h1>

  <label id="coinLbl">Coin:
    <input id="coin" placeholder="BTC" value="BTC"/>
  </label>
  <label id="slLbl">SL %:
    <input id="sl" type="number" min="0.5" max="10" step="0.1" value="2"/>
  </label>

  <button id="go">Get Signal</button>
  <button id="csv">Export CSV</button>

  <pre id="out">Click Get Signal</pre>

  <script>
    const HF = 'https://arazph-trading-signals-backend.hf.space/signal';
    const body = document.body;
    const html = document.documentElement;

    // ===== I18N =====
    const texts = {
      en:{title:"Free Trading Signals (v0.1)",coin:"Coin",sl:"SL %",go:"Get Signal",csv:"Export CSV",out:"Click Get Signal",loading:"â³ loadingâ€¦",error:"âŒ "},
      es:{title:"SeÃ±ales de Trading Gratis (v0.1)",coin:"Moneda",sl:"SL %",go:"Obtener SeÃ±al",csv:"Exportar CSV",out:"Haz clic para obtener seÃ±al",loading:"â³ cargandoâ€¦",error:"âŒ "},
      fr:{title:"Signaux de Trading Gratuits (v0.1)",coin:"PiÃ¨ce",sl:"SL %",go:"Obtenir Signal",csv:"Exporter CSV",out:"Cliquez pour obtenir le signal",loading:"â³ chargementâ€¦",error:"âŒ "},
      ar:{title:"Ø¥Ø´Ø§Ø±Ø§Øª ØªØ¯Ø§ÙˆÙ„ Ù…Ø¬Ø§Ù†ÙŠØ© (v0.1)",coin:"Ø¹Ù…Ù„Ø©",sl:"SL %",go:"Ø§Ø­ØµÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø¥Ø´Ø§Ø±Ø©",csv:"ØªØµØ¯ÙŠØ± CSV",out:"Ø§Ù†Ù‚Ø± Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø¥Ø´Ø§Ø±Ø©",loading:"â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„â€¦",error:"âŒ "},
      tr:{title:"Ãœcretsiz Trading Sinyalleri (v0.1)",coin:"Coin",sl:"SL %",go:"Sinyal Al",csv:"CSV DÄ±ÅŸa Aktar",out:"Sinyal almak iÃ§in tÄ±klayÄ±n",loading:"â³ yÃ¼kleniyorâ€¦",error:"âŒ "},
      ru:{title:"Ð‘ÐµÑÐ¿Ð»Ð°Ñ‚Ð½Ñ‹Ðµ Ð¢Ð¾Ñ€Ð³Ð¾Ð²Ñ‹Ðµ Ð¡Ð¸Ð³Ð½Ð°Ð»Ñ‹ (v0.1)",coin:"ÐœÐ¾Ð½ÐµÑ‚Ð°",sl:"SL %",go:"ÐŸÐ¾Ð»ÑƒÑ‡Ð¸Ñ‚ÑŒ Ð¡Ð¸Ð³Ð½Ð°Ð»",csv:"Ð­ÐºÑÐ¿Ð¾Ñ€Ñ‚ CSV",out:"ÐÐ°Ð¶Ð¼Ð¸Ñ‚Ðµ, Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð¿Ð¾Ð»ÑƒÑ‡Ð¸Ñ‚ÑŒ ÑÐ¸Ð³Ð½Ð°Ð»",loading:"â³ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ°â€¦",error:"âŒ "},
      "zh-CN":{title:"å…è´¹äº¤æ˜“ä¿¡å· (v0.1)",coin:"å¸ç§",sl:"SL %",go:"èŽ·å–ä¿¡å·",csv:"å¯¼å‡º CSV",out:"ç‚¹å‡»èŽ·å–ä¿¡å·",loading:"â³ åŠ è½½ä¸­â€¦",error:"âŒ "},
      pt:{title:"Sinais de Trading Gratuitos (v0.1)",coin:"Moeda",sl:"SL %",go:"Obter Sinal",csv:"Exportar CSV",out:"Clique para obter o sinal",loading:"â³ carregandoâ€¦",error:"âŒ "},
      id:{title:"Sinyal Trading Gratis (v0.1)",coin:"Koin",sl:"SL %",go:"Dapatkan Sinyal",csv:"Ekspor CSV",out:"Klik untuk mendapatkan sinyal",loading:"â³ memuatâ€¦",error:"âŒ "},
      vi:{title:"TÃ­n Hiá»‡u Giao Dá»‹ch Miá»…n PhÃ­ (v0.1)",coin:"Coin",sl:"SL %",go:"Láº¥y TÃ­n Hiá»‡u",csv:"Xuáº¥t CSV",out:"Nháº¥n Ä‘á»ƒ láº¥y tÃ­n hiá»‡u",loading:"â³ Ä‘ang táº£iâ€¦",error:"âŒ "}
    };

    const langSel = document.getElementById('lang');
    const ui = {};
    ["title","coinLbl","slLbl","go","csv","out"].forEach(id=>ui[id]=document.getElementById(id));

    function setLang(lang){
      if(!texts[lang]) lang='en';
      html.setAttribute('lang',lang);
      localStorage.setItem('lang',lang);
      Object.keys(ui).forEach(id=>ui[id].childNodes[0].textContent=texts[lang][id]);
      langSel.value=lang;
    }
    // auto-detect browser lang
    const browserLang = navigator.language.slice(0,2);
    const savedLang   = localStorage.getItem('lang') || browserLang;
    // fill selector
    Object.keys(texts).forEach(l=>{
      const o=document.createElement('option');o.value=l;o.textContent=l.toUpperCase();langSel.appendChild(o);
    });
    langSel.addEventListener('change',e=>setLang(e.target.value));
    setLang(savedLang);

    // ===== THEME =====
    const toggle = document.getElementById('themeToggle');
    const savedTheme = localStorage.getItem('theme') || 'dark';
    html.setAttribute('data-theme',savedTheme);
    toggle.addEventListener('click',()=>{
      const cur=html.getAttribute('data-theme');
      const nxt=cur==='dark'?'light':'dark';
      html.setAttribute('data-theme',nxt);
      localStorage.setItem('theme',nxt);
    });

    // ===== SIGNAL + CSV =====
    let lastSignal = null;
    document.getElementById('go').onclick = async () => {
      const c = document.getElementById('coin').value.trim() || 'BTC';
      const s = document.getElementById('sl').value;
      ui.out.textContent = texts[savedLang].loading;
      try {
        const res = await fetch(`${HF}?symbol=${c}&sl_pct=${s}`);
        if (!res.ok) throw new Error('Backend error '+res.status);
        lastSignal = await res.json();
        ui.out.textContent = JSON.stringify(lastSignal,null,2);
      } catch (e) {
        ui.out.textContent = texts[savedLang].error + e;
      }
    };

    document.getElementById('csv').onclick = () => {
      if (!lastSignal) return alert('Get a signal first');
      const row = [
        new Date().toISOString(),
        lastSignal.symbol,
        lastSignal.direction,
        lastSignal.entry,
        lastSignal.sl,
        lastSignal.tp,
        lastSignal.confidence,
        lastSignal.why
      ];
      const csv = row.map(x=>'"'+String(x).replace(/"/g,'""')+'"').join(',');
      const blob = new Blob([csv],{type:'text/csv'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'trade_'+lastSignal.symbol+'_'+Date.now()+'.csv';
      a.click();
      URL.revokeObjectURL(url);
    };
  </script>
</body>
</html>
